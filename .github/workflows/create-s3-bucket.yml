name: 
run-name: ${{ github.actor }} creating S3 bucket
on:
  push:
    branches:
      - 111
jobs:
  S3:
    name: Deploy
    runs-on: ubuntu-latest
    environment:
      name: Development
      

    steps:
      - name: Checkout code
        uses: actions/checkout@main
      - run: |
          aws s3 ls s3://final-test-project

        env: #env setup
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          
          AWS_DEFAULT_REGION: 'us-west-2'

      - name: Docker deploy in EC2
        env:
          AWS_PRIVATE_KEY: ${{ secrets.FINAL_WORK_KEY }}
                  
        run: | # can make this dinamic, but for science purpuses we made it simple like this:
            echo "$AWS_PRIVATE_KEY" > private_key && chmod 600 private_key
            
            ssh -o StrictHostKeyChecking=no -i private_key ubuntu@54.201.114.163 "
            sudo apt update&
            sudo apt install ca-certificates curl gnupg&
            sudo install -m 0755 -d /etc/apt/keyrings&
            curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg&
            sudo chmod a+r /etc/apt/keyrings/docker.gpg&
            sudo tee /etc/apt/sources.list.d/docker.list > /dev/null &
            sudo apt update&
            sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin"
